<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-waterline/waterline/lib/waterline/query/finders/joins.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-waterline">npmtest-waterline (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-waterline/waterline/lib/waterline/query/finders/joins.js</span></h1>
    <h2>
        
        Statements: <span class="metric">8.6% <small>(8 / 93)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 48)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 12)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">9.88% <small>(8 / 81)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-waterline/waterline/lib/waterline/query/finders/</a> &#187; joins.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * Module Dependencies
 */
&nbsp;
var _ = require('lodash');
var utils = require('../../utils/helpers');
var hop = utils.object.hasOwnProperty;
&nbsp;
/**
 * Logic For Handling Joins inside a Query Results Object
 */
&nbsp;
var Joins = module.exports = <span class="fstat-no" title="function not covered" >function(joins, values, identity, schema, collections) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.identity = identity;</span>
&nbsp;
  // Hold Joins specified in the criteria
<span class="cstat-no" title="statement not covered" >  this.joins = joins || [];</span>
&nbsp;
  // Hold the result values
<span class="cstat-no" title="statement not covered" >  this.values = values || [];</span>
&nbsp;
  // Hold the overall schema
<span class="cstat-no" title="statement not covered" >  this.schema = schema || {};</span>
&nbsp;
  // Hold all the Waterline collections so we can make models
<span class="cstat-no" title="statement not covered" >  this.collections = collections || {};</span>
&nbsp;
  // Build up modelOptions
<span class="cstat-no" title="statement not covered" >  this.modelOptions();</span>
&nbsp;
  // Modelize values
<span class="cstat-no" title="statement not covered" >  this.models = this.makeModels();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return this;</span>
};
&nbsp;
/**
 * Build up Join Options that will be passed down to a Model instance.
 *
 * @api private
 */
&nbsp;
Joins.prototype.modelOptions = <span class="fstat-no" title="function not covered" >function modelOptions() {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var self = this;</span>
<span class="cstat-no" title="statement not covered" >  var joins;</span>
&nbsp;
  // Build Model Options, determines what associations to render in toObject
<span class="cstat-no" title="statement not covered" >  this.options = {</span>
    showJoins: !!this.joins
  };
&nbsp;
  // If no joins were used, just return
<span class="cstat-no" title="statement not covered" >  if (!this.joins) <span class="cstat-no" title="statement not covered" >return;</span></span>
&nbsp;
  // Map out join names to pass down to the model instance
<span class="cstat-no" title="statement not covered" >  joins = this.joins.filter(<span class="fstat-no" title="function not covered" >function(join) {</span></span>
&nbsp;
    // If the value is not being selected, don't add it to the array
<span class="cstat-no" title="statement not covered" >    if (!join.select) <span class="cstat-no" title="statement not covered" >return false;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return join;</span>
  });
&nbsp;
  // Map out join key names and attach to the options object.
  // For normal assoiciations, use the child table name that is being joined. For many-to-many
  // associations the child table name won't work so grab the alias used and use that for the
  // join name. It will be the one that is transformed.
<span class="cstat-no" title="statement not covered" >  this.options.joins = joins.map(<span class="fstat-no" title="function not covered" >function(join) {</span></span>
<span class="cstat-no" title="statement not covered" >    var child = [];</span>
    // If a junctionTable was not used, return the child table
<span class="cstat-no" title="statement not covered" >    if (!join.junctionTable) <span class="cstat-no" title="statement not covered" >return join.child;</span></span>
&nbsp;
    // Find the original alias for the join
<span class="cstat-no" title="statement not covered" >    self.joins.forEach(<span class="fstat-no" title="function not covered" >function(j) {</span></span>
<span class="cstat-no" title="statement not covered" >      if (j.child !== join.parent) <span class="cstat-no" title="statement not covered" >return;</span></span>
<span class="cstat-no" title="statement not covered" >      child.push(j.alias);</span>
    });
&nbsp;
    // If a child was found, return it otherwise just return the original child join
<span class="cstat-no" title="statement not covered" >    if (child) <span class="cstat-no" title="statement not covered" >return child;</span></span>
<span class="cstat-no" title="statement not covered" >    return join.child;</span>
  });
&nbsp;
  // Flatten joins
<span class="cstat-no" title="statement not covered" >  this.options.joins = _.uniq(_.flatten(this.options.joins));</span>
};
&nbsp;
/**
 * Transform Values into instantiated Models.
 *
 * @return {Array}
 * @api private
 */
&nbsp;
Joins.prototype.makeModels = <span class="fstat-no" title="function not covered" >function makeModels() {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var self = this;</span>
<span class="cstat-no" title="statement not covered" >  var models = [];</span>
<span class="cstat-no" title="statement not covered" >  var model;</span>
&nbsp;
  // If values are invalid (not an array), return them early.
<span class="cstat-no" title="statement not covered" >  if (!this.values || !this.values.forEach) <span class="cstat-no" title="statement not covered" >return this.values;</span></span>
&nbsp;
  // Make each result an instance of model
<span class="cstat-no" title="statement not covered" >  this.values.forEach(<span class="fstat-no" title="function not covered" >function(value) {</span></span>
<span class="cstat-no" title="statement not covered" >    model = self.modelize(value);</span>
<span class="cstat-no" title="statement not covered" >    models.push(model);</span>
  });
&nbsp;
<span class="cstat-no" title="statement not covered" >  return models;</span>
};
&nbsp;
/**
 * Handle a single Result and inspect it's values for anything
 * that needs to become a Model instance.
 *
 * @param {Object} value
 * @return {Object}
 * @api private
 */
&nbsp;
Joins.prototype.modelize = <span class="fstat-no" title="function not covered" >function modelize(value) {</span>
<span class="cstat-no" title="statement not covered" >  var self = this;</span>
&nbsp;
  // Look at each key in the object and see if it was used in a join
<span class="cstat-no" title="statement not covered" >  Object.keys(value).forEach(<span class="fstat-no" title="function not covered" >function(key) {</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    var joinKey = false;</span>
<span class="cstat-no" title="statement not covered" >    var attr,</span>
        usedInJoin;
&nbsp;
    // If showJoins wasn't set or no joins were found there is nothing to modelize
<span class="cstat-no" title="statement not covered" >    if (!self.options.showJoins || !self.options.joins) <span class="cstat-no" title="statement not covered" >return;</span></span>
&nbsp;
    // Look at the schema for an attribute and check if it's a foreign key
    // or a virtual hasMany collection attribute
&nbsp;
    // Check if there is a transformation on this attribute
<span class="cstat-no" title="statement not covered" >    var transformer = self.collections[self.identity]._transformer._transformations;</span>
<span class="cstat-no" title="statement not covered" >    if (hop(transformer, key)) {</span>
<span class="cstat-no" title="statement not covered" >      attr = self.schema[transformer[key]];</span>
    } else {
<span class="cstat-no" title="statement not covered" >      attr = self.schema[key];</span>
    }
&nbsp;
    // If an attribute was found but it's not a model, this means it's a normal
    // key/value attribute and not an association so there is no need to modelize it.
<span class="cstat-no" title="statement not covered" >    if (attr &amp;&amp; !attr.hasOwnProperty('model')) <span class="cstat-no" title="statement not covered" >return;</span></span>
&nbsp;
    // If the attribute has a `model` property, the joinKey is the collection of the model
<span class="cstat-no" title="statement not covered" >    if (attr &amp;&amp; attr.hasOwnProperty('model')) <span class="cstat-no" title="statement not covered" >joinKey = attr.model;</span></span>
&nbsp;
    // If the attribute is a foreign key but it was not populated, just leave the foreign key
    // as it is and don't try and modelize it.
<span class="cstat-no" title="statement not covered" >    if (joinKey &amp;&amp; self.options.joins.indexOf(joinKey) &lt; 0) <span class="cstat-no" title="statement not covered" >return;</span></span>
&nbsp;
    // Check if the key was used in a join
<span class="cstat-no" title="statement not covered" >    usedInJoin = self.checkForJoin(key);</span>
&nbsp;
    // If the attribute wasn't used in the join, don't turn it into a model instance.
    // NOTE: Not sure if this is correct or not?
<span class="cstat-no" title="statement not covered" >    if (!usedInJoin.used) <span class="cstat-no" title="statement not covered" >return;</span></span>
&nbsp;
    // If the attribute is an array of child values, for each one make a model out of it.
<span class="cstat-no" title="statement not covered" >    if (Array.isArray(value[key])) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      var records = [];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      value[key].forEach(<span class="fstat-no" title="function not covered" >function(val) {</span></span>
<span class="cstat-no" title="statement not covered" >        var collection,</span>
            model;
&nbsp;
        // If there is a joinKey this means it's a belongsTo association so the collection
        // containing the proper model will be the name of the joinKey model.
<span class="cstat-no" title="statement not covered" >        if (joinKey) {</span>
<span class="cstat-no" title="statement not covered" >          collection = self.collections[joinKey];</span>
<span class="cstat-no" title="statement not covered" >          val = collection._transformer.unserialize(val);</span>
<span class="cstat-no" title="statement not covered" >          model = new collection._model(val, { showJoins: false });</span>
<span class="cstat-no" title="statement not covered" >          return records.push(model);</span>
        }
&nbsp;
        // Otherwise look at the join used and determine which key should be used to get
        // the proper model from the collections.
<span class="cstat-no" title="statement not covered" >        collection = self.collections[usedInJoin.join.child];</span>
<span class="cstat-no" title="statement not covered" >        val = collection._transformer.unserialize(val);</span>
<span class="cstat-no" title="statement not covered" >        model = new collection._model(val, { showJoins: false });</span>
<span class="cstat-no" title="statement not covered" >        return records.push(model);</span>
      });
&nbsp;
      // Set the value to the array of model values
<span class="cstat-no" title="statement not covered" >      value[key] = records;</span>
<span class="cstat-no" title="statement not covered" >      return;</span>
    }
&nbsp;
    // If the value isn't an array it's a populated foreign key so modelize it and attach
    // it directly on the attribute
<span class="cstat-no" title="statement not covered" >    collection = self.collections[joinKey];</span>
<span class="cstat-no" title="statement not covered" >    value[key] = collection._transformer.unserialize(value[key]);</span>
<span class="cstat-no" title="statement not covered" >    value[key] = new collection._model(value[key], { showJoins: false });</span>
  });
&nbsp;
<span class="cstat-no" title="statement not covered" >  return value;</span>
};
&nbsp;
/**
 * Test if an attribute was used in a join.
 * Requires generating a key to test against an attribute because the model process
 * will be run before any transformations have taken place.
 *
 * @param {String} key
 * @return {Object}
 * @api private
 */
&nbsp;
Joins.prototype.checkForJoin = <span class="fstat-no" title="function not covered" >function checkForJoin(key) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var generatedKey;</span>
<span class="cstat-no" title="statement not covered" >  var usedInJoin = false;</span>
<span class="cstat-no" title="statement not covered" >  var relatedJoin;</span>
&nbsp;
  // Loop through each join and see if the given key matches a join used
<span class="cstat-no" title="statement not covered" >  this.joins.forEach(<span class="fstat-no" title="function not covered" >function(join) {</span></span>
<span class="cstat-no" title="statement not covered" >    if (join.alias !== key) <span class="cstat-no" title="statement not covered" >return;</span></span>
<span class="cstat-no" title="statement not covered" >    usedInJoin = true;</span>
<span class="cstat-no" title="statement not covered" >    relatedJoin = join;</span>
  });
&nbsp;
<span class="cstat-no" title="statement not covered" >  return { used: usedInJoin, join: relatedJoin };</span>
};
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Tue Apr 11 2017 11:18:09 GMT+0000 (UTC)</div>
</div>
</body>
</html>
